<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß | Travel Map App</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* 2. ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ */
        body, h1, h2, h3, h4, p, a, button, input, div {
            font-family: 'Kanit', 'Prompt', sans-serif !important;
        }

        :root {
            --agoda-blue: #1e40af;
            --agoda-light-blue: #3b82f6;
        }
        
        body { background-color: #f3f4f6; }

        /* Hero Section Styling */
        #hero-section {
            background-color: var(--agoda-blue);
            /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏£‡∏π‡∏õ Placeholder ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏™‡πà‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á */
            background-image: url('https://placehold.co/1200x300/1e40af/ffffff?text=Travel+Thailand'); 
            background-size: cover;
            background-position: center;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* Card Styling */
        .attraction-card { transition: transform 0.2s, box-shadow 0.2s; cursor: pointer; }
        .attraction-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1); }
        
        .input-field {
            border: 1px solid #e5e7eb;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            width: 100%;
            font-family: 'Kanit', sans-serif; /* ‡∏¢‡πâ‡∏≥‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÉ‡∏ô input */
        }

        .btn-primary {
            background-color: var(--agoda-light-blue);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s;
            white-space: nowrap;
        }
        .btn-primary:hover { background-color: #2563eb; }

        .info-card { 
            background-color: #fff;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
    </style>
</head>
<body class="min-h-screen">

    <nav class="bg-white shadow-md p-4 flex justify-between items-center sticky top-0 z-10">
        <div class="text-2xl font-bold text-blue-700 flex items-center gap-2">
            üß≠ <span>Travel Map</span>
        </div>
        <div id="user-info" class="text-sm text-gray-600 bg-gray-100 p-2 rounded-full hidden sm:block px-4">
            ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...
        </div>
    </nav>

    <div id="hero-section" class="mb-10">
        <div class="bg-white p-6 md:p-8 rounded-xl shadow-2xl w-11/12 max-w-4xl -translate-y-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center md:text-left">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à</h2>
            <div class="flex flex-col md:flex-row gap-4">
                <input type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà, ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®..." class="input-field flex-grow shadow-inner">
                <button class="btn-primary w-full md:w-auto font-medium">
                    üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                </button>
            </div>
        </div>
    </div>

    <main class="container mx-auto px-4 -mt-8 pb-10">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
             
            <div class="lg:col-span-1 space-y-8">
                 
                <div class="info-card">
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">üõ†Ô∏è ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°</h3>
                    <p class="text-gray-600 mb-4 text-sm">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß?</p>
                    <a href="admin.html" id="admin-link" class="btn-primary w-full block mb-2 text-center text-sm shadow-md">
                        ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Admin)
                    </a>
                    
                    <hr class="my-4 border-gray-200">
                    
                    <p class="text-gray-600 mb-2 text-sm">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å:</p>
                    <a href="https://www.google.com/maps" target="_blank" class="text-sm text-blue-500 hover:text-blue-700 font-medium flex items-center justify-center gap-1">
                        üåè ‡πÄ‡∏õ‡∏¥‡∏î Google Maps
                    </a>
                </div>

                <div id="message-box" class="mt-4 p-3 rounded-lg text-sm hidden"></div>
            </div>

            <div class="lg:col-span-2">
                <div class="flex justify-between items-end mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">‚ú® ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</h2>
                    <span class="text-xs text-green-600 bg-green-100 px-2 py-1 rounded-full animate-pulse">‚óè ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (Real-time)</span>
                </div>
                
                <div id="locations-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="col-span-full text-center p-12 bg-white rounded-xl shadow-sm text-gray-500 flex flex-col items-center">
                        <svg class="animate-spin h-8 w-8 text-blue-500 mb-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                    </div>
                </div>
            </div>
        </div>
    </main>
     
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
         
        // ******************************************************
        // ‚ö†Ô∏è Firebase Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        // ******************************************************
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyB7bEabkGgF_mxmA-l9J6Lvd_3Au2qNX00",
            authDomain: "travel-roams.firebaseapp.com",
            projectId: "travel-roams",
            storageBucket: "travel-roams.firebasestorage.app",
            messagingSenderId: "745882789310",
            appId: "1:745882789310:web:dd01bc9121587efbaa45ef",
            measurementId: "G-FDB92BT0RJ"
        };
        const APP_ID = 'travel-map'; 

        setLogLevel('silent'); // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô silent ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î Log ‡∏Ç‡∏¢‡∏∞‡πÉ‡∏ô Console

        let app, db, auth;
        let userId = 'loading';
        
        const messageBox = document.getElementById('message-box');
        const userInfoDiv = document.getElementById('user-info');
        const locationsListDiv = document.getElementById('locations-list');

        let isConfigValid = true;
        if (!FIREBASE_CONFIG.apiKey) {
             userInfoDiv.innerHTML = '<span class="text-red-600">‚ùå Config ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</span>';
             locationsListDiv.innerHTML = '<div class="col-span-full text-center p-8 bg-red-50 rounded-xl border border-red-200 text-red-700">‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÑ‡∏°‡πà‡∏û‡∏ö API Key ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase</div>';
             console.error("Firebase API Key is missing.");
             isConfigValid = false;
        }

        async function initializeFirebase() {
            if (!isConfigValid) return;

            try {
                app = initializeApp(FIREBASE_CONFIG);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        userInfoDiv.innerHTML = `üë§ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: <span class="font-mono text-blue-600">${userId.substring(0, 6)}...</span>`;
                        listenForAttractions();
                    } else {
                        try {
                            await signInAnonymously(auth);
                        } catch (authError) {
                             userInfoDiv.innerHTML = `‚ùå ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`;
                             locationsListDiv.innerHTML = `<div class="col-span-full text-center p-8 bg-red-50 text-red-700">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô (${authError.code})</div>`;
                        }
                    }
                });

            } catch (error) {
                userInfoDiv.innerHTML = `‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î Firebase`;
                console.error(`Error initializing Firebase: ${error.message}`);
            }
        }
        
        initializeFirebase();

        function listenForAttractions() {
            if (!db || userId === 'loading') return;

            const collectionPath = `artifacts/${APP_ID}/public/data/attractions`;
            const q = collection(db, collectionPath);
            
            onSnapshot(q, (snapshot) => {
                const attractions = [];

                if (snapshot.empty) {
                    locationsListDiv.innerHTML = `
                        <div class="col-span-full text-center p-12 bg-white rounded-xl border-dashed border-2 border-gray-300 text-gray-500">
                            <p class="text-lg">üì≠ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</p>
                            <p class="text-sm">‡∏•‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏°‡∏ô‡∏π Admin</p>
                        </div>`;
                    return; // ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                }

                snapshot.docChanges().forEach((change) => {
                    const data = change.doc.data();
                    const attraction = { id: change.doc.id, ...data };
                    
                    if (change.type !== "removed") { attractions.push(attraction); }
                });

                // Render cards
                if (attractions.length > 0) {
                    locationsListDiv.innerHTML = '';
                    attractions.forEach(attraction => {
                        // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡πà‡∏≤ null/undefined
                        const name = attraction.name || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà";
                        const desc = attraction.description || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î";
                        const lat = attraction.lat || "0";
                        const lng = attraction.lng || "0";
                        const googleMapsLink = `https://www.google.com/maps/search/?api=1&query=${lat},${lng}`;
                        
                        const dateStr = attraction.timestamp ? new Date(attraction.timestamp.toMillis()).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' }) : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà';
                        
                        const item = document.createElement('div');
                        item.className = 'attraction-card bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg flex flex-col h-full';
                        item.innerHTML = `
                            <div class="h-48 bg-cover bg-center relative group" style="background-image: url('https://placehold.co/600x400/3b82f6/ffffff?text=${encodeURIComponent(name)}');">
                                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-all duration-300"></div>
                            </div>
                            <div class="p-5 flex flex-col flex-grow">
                                <h4 class="text-xl font-bold text-blue-800 mb-2 leading-tight">${name}</h4>
                                <p class="text-sm text-gray-600 mb-4 line-clamp-3 flex-grow">${desc}</p>
                                
                                <div class="mt-auto">
                                    <a href="${googleMapsLink}" target="_blank" class="flex items-center justify-center gap-2 text-sm text-white bg-green-500 hover:bg-green-600 py-2 px-4 rounded-lg transition-colors shadow-sm font-medium">
                                        üìç ‡∏î‡∏π‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
                                    </a>

                                    <div class="flex justify-between items-center text-xs text-gray-400 pt-3 border-t mt-4">
                                        <span class="flex items-center gap-1">üë§ ‡πÇ‡∏î‡∏¢: ${attraction.userId ? attraction.userId.substring(0, 4) : 'Unknown'}...</span>
                                        <span class="flex items-center gap-1">üïí ${dateStr}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                        locationsListDiv.appendChild(item);
                    });
                }
            }, (error) => {
                locationsListDiv.innerHTML = `<div class="col-span-full p-4 bg-red-100 text-red-700 rounded-lg text-center">‚ùå ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ${error.message}</div>`;
            });
        }
    </script>
</body>
</html>
