<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß | Travel Map App</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --agoda-blue: #1e40af;
            --agoda-light-blue: #3b82f6;
        }
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        /* Hero Section Styling */
        #hero-section {
            background-color: var(--agoda-blue);
            background-image: url('https://placehold.co/1200x300/1e40af/ffffff?text=Travel+the+World');
            background-size: cover;
            background-position: center;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        /* Card Styling */
        .attraction-card { transition: transform 0.2s, box-shadow 0.2s; cursor: pointer; }
        .attraction-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1); }
        .input-field {
            border: 1px solid #e5e7eb;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            width: 100%;
        }
        .btn-primary {
            background-color: var(--agoda-light-blue);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s;
        }
        .btn-primary:hover { background-color: #2563eb; }
        .info-card { 
            background-color: #fff;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
    </style>
    <!-- Google Maps API ‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß -->
</head>
<body class="min-h-screen">

    <!-- Header / Navigation Bar -->
    <nav class="bg-white shadow-md p-4 flex justify-between items-center sticky top-0 z-10">
        <div class="text-2xl font-bold text-blue-700">üß≠ Travel Map</div>
        <div id="user-info" class="text-sm text-gray-600 bg-gray-100 p-2 rounded-full hidden sm:block">
            ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...
        </div>
    </nav>

    <!-- Hero Section with Search Bar -->
    <div id="hero-section" class="mb-10">
        <div class="bg-white p-6 md:p-8 rounded-xl shadow-2xl w-11/12 max-w-4xl -translate-y-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à</h2>
            <!-- Simulated Search/Filter Bar -->
            <div class="flex flex-col md:flex-row gap-4">
                <input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà, ‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®..." class="input-field flex-grow shadow-inner">
                <button class="btn-primary w-full md:w-auto">
                    ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                </button>
            </div>
        </div>
    </div>

    <main class="container mx-auto px-4 -mt-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Column 1: Links and Info (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà Map) -->
            <div class="lg:col-span-1 space-y-8">
                
                <!-- Info Card for Admin/Maps -->
                <div class="info-card">
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">üõ†Ô∏è ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</h3>
                    <p class="text-gray-600 mb-4 text-sm">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
                    <a href="admin.html" id="admin-link" class="btn-primary w-full block mb-2 text-center text-sm">
                        ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ Admin
                    </a>
                    <p class="text-gray-600 mb-4 mt-4 text-sm">‡∏î‡∏π‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å:</p>
                    <a href="https://www.google.com/maps" target="_blank" class="text-sm text-blue-500 hover:text-blue-700">
                        ‡πÄ‡∏õ‡∏¥‡∏î Google Maps
                    </a>
                </div>

                <div id="message-box" class="mt-4 p-3 rounded-lg text-sm hidden"></div>

            </div>

            <!-- Column 2 & 3: Attraction List -->
            <div class="lg:col-span-2">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">‚ú® ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏° (Real-time)</h2>
                <div id="locations-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Cards will be injected here -->
                    <div class="col-span-full text-center p-8 bg-white rounded-xl shadow-md text-gray-500">
                        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å Firestore...
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- JavaScript Section -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // ******************************************************
        // ‚ö†Ô∏è Firebase Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        // ******************************************************
        const FIREBASE_CONFIG = {
¬† ¬† ¬† ¬† ¬† ¬† apiKey: "AIzaSyB7bEabkGgF_mxmA-l9J6Lvd_3Au2qNX00",
¬† ¬† ¬† ¬† ¬† ¬† authDomain: "travel-roams.firebaseapp.com",
¬† ¬† ¬† ¬† ¬† ¬† projectId: "travel-roams",
¬† ¬† ¬† ¬† ¬† ¬† storageBucket: "travel-roams.firebasestorage.app",
¬† ¬† ¬† ¬† ¬† ¬† messagingSenderId: "745882789310",
¬† ¬† ¬† ¬† ¬† ¬† appId: "1:745882789310:web:dd01bc9121587efbaa45ef",
¬† ¬† ¬† ¬† ¬† ¬† measurementId: "G-FDB92BT0RJ"
¬† ¬† ¬† ¬† };
        const APP_ID = 'travel-map'; 

        setLogLevel('Debug');

        let app, db, auth;
        let userId = 'loading';
        
        const messageBox = document.getElementById('message-box');
        const userInfoDiv = document.getElementById('user-info');
        const locationsListDiv = document.getElementById('locations-list');

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Config ‡∏ñ‡∏π‡∏Å‡πÉ‡∏™‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        let isConfigValid = true;
        if (!FIREBASE_CONFIG.apiKey) {
             userInfoDiv.innerHTML = '<span class="text-red-600">‚ùå Config ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</span>';
             locationsListDiv.innerHTML = '<div class="col-span-full text-center p-8 bg-red-100 rounded-xl shadow-md text-red-700">‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: API Key ‡∏´‡∏≤‡∏¢‡πÑ‡∏õ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Firebase Config</div>';
             console.error("Firebase API Key is missing.");
             isConfigValid = false;
        }

        async function initializeFirebase() {
            if (!isConfigValid) return; // ‡∏ñ‡πâ‡∏≤ Config ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠

            try {
                app = initializeApp(FIREBASE_CONFIG);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        userInfoDiv.innerHTML = `‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: <span class="font-mono">${userId.substring(0, 8)}...</span>`;
                        listenForAttractions();
                    } else {
                        // ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡∏ô‡∏¥‡∏£‡∏ô‡∏≤‡∏°
                        await signInAnonymously(auth);
                        // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ onAuthStateChanged ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ã‡πâ‡∏≥‡πÄ‡∏°‡∏∑‡πà‡∏≠ signInAnonymously ‡πÄ‡∏™‡∏£‡πá‡∏à
                    }
                });

            } catch (error) {
                userInfoDiv.innerHTML = `‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î Firebase`;
                console.error(`Error initializing Firebase: ${error.message}`);
            }
        }
        
        initializeFirebase();

        function showStatus(message, className) {
            console.log(`Status: ${message} (Class: ${className})`);
        }

        function listenForAttractions() {
            if (!db || userId === 'loading') return;

            const collectionPath = `artifacts/${APP_ID}/public/data/attractions`;
            const q = collection(db, collectionPath);
            
            onSnapshot(q, (snapshot) => {
                locationsListDiv.innerHTML = '';
                const attractions = [];

                if (snapshot.empty) {
                    locationsListDiv.innerHTML = '<div class="col-span-full text-center p-8 bg-white rounded-xl shadow-md text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>';
                }

                snapshot.docChanges().forEach((change) => {
                    const data = change.doc.data();
                    const attraction = { id: change.doc.id, ...data };
                    
                    if (change.type !== "removed") { attractions.push(attraction); }
                });

                // Render cards
                if (attractions.length > 0) {
                    locationsListDiv.innerHTML = '';
                    attractions.forEach(attraction => {
                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Google Maps ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏û‡∏¥‡∏Å‡∏±‡∏î
                        const googleMapsLink = `https://www.google.com/maps/search/?api=1&query=${attraction.lat},${attraction.lng}`;
                        
                        const dateStr = attraction.timestamp ? new Date(attraction.timestamp.toMillis()).toLocaleDateString('th-TH') : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                        const item = document.createElement('div');
                        item.className = 'attraction-card bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg';
                        item.innerHTML = `
                            <div class="h-40 bg-cover bg-center" style="background-image: url('https://placehold.co/600x400/3b82f6/ffffff?text=${attraction.name.substring(0, 12)}');"></div>
                            <div class="p-4">
                                <h4 class="text-xl font-bold text-blue-700 mb-1">${attraction.name}</h4>
                                <p class="text-sm text-gray-600 mb-2">${attraction.description}</p>
                                
                                <a href="${googleMapsLink}" target="_blank" class="text-sm text-center text-white bg-green-500 hover:bg-green-600 py-2 px-4 rounded-lg block mt-3 transition-colors">
                                    üìç ‡∏î‡∏π‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ö‡∏ô Google Maps
                                </a>

                                <div class="flex justify-between items-center text-xs text-gray-500 pt-2 border-t mt-3">
                                    <span>‚ú® By: ${attraction.userId.substring(0, 4)}...</span>
                                    <span>üìÖ ${dateStr}</span>
                                </div>
                            </div>
                        `;
                        locationsListDiv.appendChild(item);
                    });
                }
            }, (error) => {
                showStatus(`‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${error.message}`, 'bg-red-200 text-red-800');
            });
        }
    </script>
</body>
</html>