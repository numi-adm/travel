<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Map | ค้นหาจุดหมายการเดินทางของคุณ</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #f8fafc;
        }
        .hero-gradient {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
        }
        .glass-morphism {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .attraction-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .attraction-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        /* Skeleton Animation */
        @keyframes shimmer {
            0% { background-position: -468px 0; }
            100% { background-position: 468px 0; }
        }
        .skeleton {
            background: #f6f7f8;
            background-image: linear-gradient(to right, #f6f7f8 0%, #edeef1 20%, #f6f7f8 40%, #f6f7f8 100%);
            background-repeat: no-repeat;
            background-size: 800px 104px;
            display: inline-block;
            position: relative;
            animation: shimmer 1s linear infinite forwards;
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Navigation -->
    <nav class="bg-white/80 backdrop-blur-md shadow-sm p-4 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg">
                    <i class="fas fa-map-marked-alt text-xl"></i>
                </div>
                <span class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-700 to-blue-500">TravelRoams</span>
            </div>
            <div class="flex items-center gap-4">
                <a href="admin.html" class="hidden md:flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-blue-600 transition-colors">
                    <i class="fas fa-user-shield"></i> สำหรับผู้ดูแล
                </a>
                <div id="user-info" class="text-xs bg-gray-100 px-4 py-2 rounded-full text-gray-500 font-medium border border-gray-200">
                    <i class="fas fa-circle-notch animate-spin mr-1"></i> กำลังโหลด...
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-gradient pt-20 pb-32 px-4">
        <div class="container mx-auto text-center">
            <h1 class="text-4xl md:text-6xl font-bold text-white mb-6 leading-tight">ค้นพบโลกกว้าง <br><span class="text-blue-200">ในแบบที่คุณต้องการ</span></h1>
            <p class="text-blue-100 text-lg mb-10 max-w-2xl mx-auto font-light">รวมพิกัดลับและสถานที่ท่องเที่ยวยอดฮิตจากทั่วประเทศ อัปเดตแบบเรียลไทม์โดยชุมชนนักเดินทาง</p>
            
            <div class="max-w-3xl mx-auto glass-morphism p-2 rounded-2xl shadow-2xl flex flex-col md:flex-row gap-2">
                <div class="flex-grow flex items-center px-4 gap-3">
                    <i class="fas fa-search text-blue-500"></i>
                    <input type="text" id="search-input" placeholder="ค้นหาชื่อสถานที่ หรือจังหวัด..." class="w-full py-4 bg-transparent outline-none text-gray-700 font-medium">
                </div>
                <button class="bg-blue-600 hover:bg-blue-700 text-white px-10 py-4 rounded-xl font-bold transition-all shadow-lg active:scale-95">
                    ค้นหาเลย
                </button>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="container mx-auto px-4 -mt-16 pb-20">
        <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
            <div>
                <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                    <i class="fas fa-fire text-orange-500"></i> สถานที่ยอดนิยม
                </h2>
                <p class="text-gray-500 text-sm">อัปเดตล่าสุด: <span id="last-update" class="font-medium text-blue-600">กำลังตรวจสอบ...</span></p>
            </div>
            <div class="flex gap-2">
                <button class="px-4 py-2 bg-white rounded-lg shadow-sm text-sm font-medium text-gray-600 hover:bg-gray-50 border border-gray-100">
                    <i class="fas fa-filter mr-1"></i> ทั้งหมด
                </button>
                <a href="https://www.google.com/maps" target="_blank" class="px-4 py-2 bg-white rounded-lg shadow-sm text-sm font-medium text-green-600 hover:bg-gray-50 border border-gray-100">
                    <i class="fas fa-location-arrow mr-1"></i> แผนที่โลก
                </a>
            </div>
        </div>

        <div id="locations-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            <!-- Skeleton Loading Items -->
            <div class="bg-white rounded-2xl shadow-sm h-96 skeleton"></div>
            <div class="bg-white rounded-2xl shadow-sm h-96 skeleton"></div>
            <div class="bg-white rounded-2xl shadow-sm h-96 skeleton"></div>
            <div class="bg-white rounded-2xl shadow-sm h-96 skeleton"></div>
        </div>
    </main>

    <footer class="bg-white border-t border-gray-200 py-10 mt-20">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-400 text-sm">© 2025 TravelRoams App. สร้างด้วย ❤️ เพื่อนักเดินทางทุกคน</p>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyB7bEabkGgF_mxmA-l9J6Lvd_3Au2qNX00",
            authDomain: "travel-roams.firebaseapp.com",
            projectId: "travel-roams",
            storageBucket: "travel-roams.firebasestorage.app",
            messagingSenderId: "745882789310",
            appId: "1:745882789310:web:dd01bc9121587efbaa45ef",
            measurementId: "G-FDB92BT0RJ"
        };
        const APP_ID = 'travel-map';

        let db, auth, userId;
        let allAttractions = [];

        const locationsListDiv = document.getElementById('locations-list');
        const searchInput = document.getElementById('search-input');
        const userInfoDiv = document.getElementById('user-info');
        const lastUpdateSpan = document.getElementById('last-update');

        async function init() {
            const app = initializeApp(FIREBASE_CONFIG);
            db = getFirestore(app);
            auth = getAuth(app);

            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    userInfoDiv.innerHTML = `<i class="fas fa-user-circle mr-1"></i> ID: ${userId.substring(0, 6)}`;
                    fetchData();
                } else {
                    await signInAnonymously(auth);
                }
            });
        }

        function fetchData() {
            const q = collection(db, 'artifacts', APP_ID, 'public', 'data', 'attractions');
            onSnapshot(q, (snapshot) => {
                allAttractions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                render(allAttractions);
                lastUpdateSpan.textContent = new Date().toLocaleTimeString('th-TH');
            }, (error) => {
                locationsListDiv.innerHTML = `<p class="col-span-full text-center text-red-500">ข้อผิดพลาดในการโหลดข้อมูล: ${error.message}</p>`;
            });
        }

        function render(items) {
            if (items.length === 0) {
                locationsListDiv.innerHTML = `<div class="col-span-full py-20 text-center"><i class="fas fa-search-minus text-4xl text-gray-300 mb-4 block"></i><p class="text-gray-500">ไม่พบสถานที่ที่ต้องการ</p></div>`;
                return;
            }

            locationsListDiv.innerHTML = items.map(item => {
                const img = item.imageData || `https://loremflickr.com/600/400/travel,view?random=${item.id}`;
                const lat = item.lat || 0;
                const lng = item.lng || 0;
                const gmap = `https://www.google.com/maps/search/?api=1&query=${lat},${lng}`;
                
                return `
                    <div class="attraction-card bg-white rounded-3xl overflow-hidden border border-gray-100 flex flex-col h-full group">
                        <div class="relative h-60 overflow-hidden">
                            <img src="${img}" alt="${item.name}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                            <div class="absolute top-4 right-4 bg-white/90 backdrop-blur px-3 py-1 rounded-full text-[10px] font-bold text-blue-600 shadow-sm">
                                <i class="fas fa-star mr-1"></i>แนะนำ
                            </div>
                        </div>
                        <div class="p-6 flex flex-col flex-grow">
                            <h3 class="text-xl font-bold text-gray-800 mb-2 group-hover:text-blue-600 transition-colors">${item.name}</h3>
                            <p class="text-gray-500 text-sm line-clamp-2 mb-6 font-light">${item.description}</p>
                            
                            <div class="mt-auto space-y-4">
                                <div class="flex items-center justify-between text-[11px] text-gray-400">
                                    <span class="flex items-center gap-1"><i class="far fa-calendar-alt"></i> ${item.timestamp ? new Date(item.timestamp.toMillis()).toLocaleDateString('th-TH') : 'เร็วๆ นี้'}</span>
                                    <span class="flex items-center gap-1"><i class="far fa-user"></i> ${item.userId?.substring(0, 4)}...</span>
                                </div>
                                <a href="${gmap}" target="_blank" class="flex items-center justify-center gap-2 w-full py-3 bg-blue-50 text-blue-600 rounded-2xl font-bold hover:bg-blue-600 hover:text-white transition-all">
                                    <i class="fas fa-map-marker-alt"></i> นำทางด้วยแผนที่
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        searchInput.addEventListener('input', (e) => {
            const val = e.target.value.toLowerCase();
            const filtered = allAttractions.filter(item => 
                item.name.toLowerCase().includes(val) || 
                item.description.toLowerCase().includes(val)
            );
            render(filtered);
        });

        init();
    </script>
</body>
</html>