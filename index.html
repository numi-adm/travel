<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß | Travel Map App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --agoda-blue: #1e40af;
            --agoda-light-blue: #3b82f6;
        }
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
     
        #hero-section {
            background-color: var(--agoda-blue);
            background-image: url('https://placehold.co/1200x300/1e40af/ffffff?text=Travel+the+World');
            background-size: cover;
            background-position: center;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
     
        #map { height: 400px; width: 100%; border-radius: 0.75rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .attraction-card { transition: transform 0.2s, box-shadow 0.2s; cursor: pointer; }
        .attraction-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1); }
        .input-field {
            border: 1px solid #e5e7eb;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            width: 100%;
        }
        .btn-primary {
            background-color: var(--agoda-light-blue);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s;
        }
        .btn-primary:hover { background-color: #2563eb; }
        .info-window-content h3 { color: var(--agoda-blue); }
    </style>
  
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY_HERE&callback=initMap"></script>
</head>
<body class="min-h-screen">

    <nav class="bg-white shadow-md p-4 flex justify-between items-center sticky top-0 z-10">
        <div class="text-2xl font-bold text-blue-700">üß≠ Travel Map</div>
        <div id="user-info" class="text-sm text-gray-600 bg-gray-100 p-2 rounded-full hidden sm:block">
            ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...
        </div>
    </nav>


    <div id="hero-section" class="mb-10">
        <div class="bg-white p-6 md:p-8 rounded-xl shadow-2xl w-11/12 max-w-4xl -translate-y-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à</h2>

            <div class="flex flex-col md:flex-row gap-4">
                <input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà, ‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®..." class="input-field flex-grow shadow-inner">
                <button class="btn-primary w-full md:w-auto">
                    ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                </button>
            </div>
        </div>
    </div>

    <main class="container mx-auto px-4 -mt-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-1 space-y-8">
                
  
                <div class="bg-white p-4 rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">üìç ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î</h3>
                    <div id="map">
                        <div class="flex items-center justify-center h-full text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà...</div>
                    </div>
                </div>

 

            </div>

      
            <div class="lg:col-span-2">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">‚ú® ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏° (Real-time)</h2>
                <div id="locations-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
      
                    <div class="col-span-full text-center p-8 bg-white rounded-xl shadow-md text-gray-500">
                        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å Firestore...
                    </div>
                </div>
            </div>
        </div>
    </main>
    

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        

        const FIREBASE_CONFIG = {
  apiKey: "AIzaSyB7bEabkGgF_mxmA-l9J6Lvd_3Au2qNX00",
  authDomain: "travel-roams.firebaseapp.com",
  projectId: "travel-roams",
  storageBucket: "travel-roams.firebasestorage.app",
  messagingSenderId: "745882789310",
  appId: "1:745882789310:web:dd01bc9121587efbaa45ef",
  measurementId: "G-FDB92BT0RJ"
};
        const APP_ID = 'travel-map'; 

        setLogLevel('Debug');

        let app, db, auth, map;
        let userId = 'loading';
        const markers = {}; 
        let tempMarker = null; 
        const defaultCenter = { lat: 13.736717, lng: 100.523186 };

     
        const messageBox = document.getElementById('message-box');
        const userInfoDiv = document.getElementById('user-info');
        const locationsListDiv = document.getElementById('locations-list');

        if (FIREBASE_CONFIG.apiKey === 'FIREBASE_CONFIG_HERE') {
            showStatus("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Firebase Config ‡πÅ‡∏•‡∏∞ Google Maps API Key", 'bg-red-200 text-red-800');
            return;
        }

        async function initializeFirebase() {
            try {
                app = initializeApp(FIREBASE_CONFIG);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        userInfoDiv.innerHTML = `‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: <span class="font-mono">${userId.substring(0, 8)}...</span>`;
                        listenForAttractions();
                    } else {
                        await signInAnonymously(auth);
                        userInfoDiv.innerHTML = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...`;
                    }
                });

            } catch (error) {
                showStatus(`‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î Firebase: ${error.message}`, 'bg-red-200 text-red-800');
            }
        }
        
        window.initMap = function() {
            const mapOptions = {
                center: defaultCenter,
                zoom: 8,
                mapId: 'DEMO_MAP_ID',
                streetViewControl: false,
                mapTypeControl: false,
            };
            map = new google.maps.Map(document.getElementById('map'), mapOptions);



            initializeFirebase();
        };

        function showStatus(message, className) {
            
            console.log(`Status: ${message} (Class: ${className})`);
        }

        function addAttractionMarker(attraction) {
            const position = { lat: attraction.lat, lng: attraction.lng };
            
            const infoWindow = new google.maps.InfoWindow({
                content: `
                    <div class="info-window-content p-2">
                        <h3 class="text-lg font-semibold">${attraction.name}</h3>
                        <p class="text-sm">${attraction.description}</p>
                    </div>
                `
            });

            const marker = new google.maps.Marker({
                position: position,
                map: map,
                title: attraction.name,
                animation: google.maps.Animation.DROP,
                icon: { url: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png' }
            });

            marker.addListener('click', () => {
                infoWindow.open({ anchor: marker, map });
            });

            markers[attraction.id] = marker;
            marker.infoWindow = infoWindow;
        }

    
        
        function listenForAttractions() {
            if (!db || userId === 'loading') return;

            const collectionPath = `artifacts/${APP_ID}/public/data/attractions`;
            const q = collection(db, collectionPath);
            
            onSnapshot(q, (snapshot) => {
                locationsListDiv.innerHTML = '';
                const attractions = [];

                if (snapshot.empty) {
                    locationsListDiv.innerHTML = '<div class="col-span-full text-center p-8 bg-white rounded-xl shadow-md text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>';
                }

                snapshot.docChanges().forEach((change) => {
                    const data = change.doc.data();
                    const attraction = { id: change.doc.id, ...data };
                    
                    if (change.type === "added" || change.type === "modified") {
                        if (map) {
                            if (markers[attraction.id]) {
                                markers[attraction.id].setMap(null);
                                delete markers[attraction.id];
                            }
                            addAttractionMarker(attraction);
                        }
                    } else if (change.type === "removed") {
                        if (markers[attraction.id]) {
                            markers[attraction.id].infoWindow.close(); 
                            markers[attraction.id].setMap(null);
                            delete markers[attraction.id];
                        }
                    }
                    if (change.type !== "removed") { attractions.push(attraction); }
                });

                
                if (attractions.length > 0) {
                    locationsListDiv.innerHTML = '';
                    attractions.forEach(attraction => {
                        const dateStr = attraction.timestamp ? new Date(attraction.timestamp.toMillis()).toLocaleDateString('th-TH') : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                        const item = document.createElement('div');
                        item.className = 'attraction-card bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg';
                        item.innerHTML = `
                            <div class="h-40 bg-cover bg-center" style="background-image: url('https://placehold.co/600x400/3b82f6/ffffff?text=${attraction.name.substring(0, 12)}');"></div>
                            <div class="p-4">
                                <h4 class="text-xl font-bold text-blue-700 mb-1">${attraction.name}</h4>
                                <p class="text-sm text-gray-600 mb-2">${attraction.description}</p>
                                <div class="flex justify-between items-center text-xs text-gray-500 pt-2 border-t mt-2">
                                    <span>‚ú® By: ${attraction.userId.substring(0, 4)}...</span>
                                    <span>üìÖ ${dateStr}</span>
                                </div>
                            </div>
                        `;
                        item.addEventListener('click', () => {
                            if (markers[attraction.id] && map) {
                                map.setCenter(markers[attraction.id].getPosition());
                                map.setZoom(14);
                                google.maps.event.trigger(markers[attraction.id], 'click');
                            }
                        });
                        locationsListDiv.appendChild(item);
                    });
                }
            }, (error) => {
                showStatus(`‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${error.message}`, 'bg-red-200 text-red-800');
            });
        }
    </script>
</body>
</html>